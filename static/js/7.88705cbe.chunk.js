(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[7],{243:function(e,n,t){"use strict";t.d(n,"a",(function(){return f}));var r=t(37),a=t(38),i=t(40),s=t(39),o=t(41),l=t(0),u=t.n(l),c=t(16),d=t(26),g=function(e){return{isAuth:e.auth.isAuth}},f=function(e){var n=function(n){function t(){return Object(r.a)(this,t),Object(i.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(o.a)(t,n),Object(a.a)(t,[{key:"render",value:function(){return this.props.isAuth?u.a.createElement(e,this.props):u.a.createElement(d.a,{to:"/login"})}}]),t}(u.a.Component);return Object(c.b)(g)(n)}},313:function(e,n,t){e.exports=t.p+"static/media/dialogs.74d9e7cd.svg"},325:function(e,n,t){"use strict";t.r(n);var r=t(17),a=t(0),i=t.n(a),s=t(16),o=t(26),l=t(2),u=t(3),c=t(69),d=t(6),g=t(127),f=t(128);function b(){var e=Object(l.a)(["\n  flex: none;\n  border: none;\n  background-color: transparent;\n  font-weight: 700;\n  color: ",";\n  cursor: pointer;\n  pointer-events: ",";\n\n  &:active {\n    opacity: 0.6;\n  }\n"]);return b=function(){return e},e}function p(){var e=Object(l.a)(["\n  flex: 1;\n  border: none;\n  outline: 0;\n  min-width: 100px;\n  min-height: 28px;\n  max-height: 200px;\n  resize: none;\n  overflow-y: auto;\n  overflow-x: hidden;\n  word-wrap: break-word;\n"]);return p=function(){return e},e}function m(){var e=Object(l.a)(["\n  flex: none;\n  display: flex;\n  margin: 5px 10px 0;\n  padding: 10px 20px;\n  min-height: 50px;\n  border: 1px solid ",";\n  border-radius: 30px;\n  background-color: ",";\n"]);return m=function(){return e},e}var v=u.b.form(m(),d.a.border,d.a.light),h=Object(u.b)(g.a)(p()),I=u.b.input.attrs({type:"submit",value:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})(b(),d.a.secondary,(function(e){return e.disabled?"none":"auto"})),x=Object(f.a)({form:"sendMessage"})((function(e){return i.a.createElement(v,{onSubmit:e.handleSubmit},i.a.createElement(h,{name:"message",component:"textarea",autoFocus:!0,onKeyDown:function(n){13===n.keyCode&&e.handleSubmit()}}),i.a.createElement(I,{disabled:e.isSendingMessageInProgress}))}));function j(){var e=Object(l.a)(["\n  align-self: flex-start;\n  border: 1px solid ",";\n  background-color: ",";\n"]);return j=function(){return e},e}function O(){var e=Object(l.a)(["\n  align-self: flex-end;\n  background-color: rgba(0, 0, 0, 0.05);\n"]);return O=function(){return e},e}function w(){var e=Object(l.a)(["\n  display: flex;\n  flex-direction: column;\n  margin-top: 10px;\n  background-color: ",";\n"]);return w=function(){return e},e}function E(){var e=Object(l.a)(["\n  padding: 10px 20px;\n  border-radius: 30px;\n"]);return E=function(){return e},e}var M=u.b.div(E()),y=u.b.div(w(),(function(e){return e.viewed?"transparent":"rgba(0,0,0, 0.02)"})),z=Object(u.b)(M)(O()),D=Object(u.b)(M)(j(),d.a.border,d.a.light),P=function(e){var n=e.friendId!==e.senderId;return i.a.createElement(y,{viewed:e.viewed},n?i.a.createElement(z,null,e.body):i.a.createElement(D,null,e.body))},k=t(36);function G(){var e=Object(l.a)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n  padding: 15px;\n  width: 100%;\n"]);return G=function(){return e},e}function S(){var e=Object(l.a)(["\n  flex: 1 1 auto;\n  display: flex;\n  flex-direction: column;\n  overflow-y: auto;\n"]);return S=function(){return e},e}var A=u.b.div(S()),C=u.b.div(G()),T=function(e){var n=Object(a.useRef)(null),t=null===e.messages?0:e.messages.length;if(Object(a.useEffect)((function(){t&&n.current.scrollIntoView({behavior:"smooth"})}),[e.friendId,t]),null===e.messages)return i.a.createElement(k.a,null);var r=e.messages.map((function(n,t){var r=n.addedAt,a=n.body,s=n.id,o=n.isSpam,l=n.recepientId,u=n.recepientName,c=n.senderId,d=n.senderName,g=n.viewed;return i.a.createElement(P,{addedAt:r,body:a,id:s,isSpam:o,recepientId:l,recepientName:u,senderId:c,senderName:d,viewed:g,friendId:e.friendId,key:t})}));return i.a.createElement(A,null,i.a.createElement(C,null,r),i.a.createElement("div",{ref:n}))},N=t(58),U=t.n(N),F=t(15);function J(){var e=Object(l.a)(["\n  display: flex;\n  align-items: center;\n"]);return J=function(){return e},e}function R(){var e=Object(l.a)(["\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  overflow: hidden;\n"]);return R=function(){return e},e}function K(){var e=Object(l.a)(["\n  color: ",";\n"]);return K=function(){return e},e}function V(){var e=Object(l.a)(["\n  margin-right: 15px;\n  font-size: 18px;\n  font-weight: 600;\n"]);return V=function(){return e},e}function q(){var e=Object(l.a)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 15px;\n  border-bottom: 1px solid ",";\n"]);return q=function(){return e},e}var B=u.b.div(q(),d.a.border),H=u.b.span(V()),L=u.b.span(K(),d.a.textThree),Q=u.b.div(R()),W=u.b.div(J()),X=function(e){var n=e.dialogInfo,t=n.id,r=n.userName,a=n.photos,s=n.lastUserActivityDate,o=new Date(Date.parse(s)),l=new Intl.DateTimeFormat("ru",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(o);return i.a.createElement(B,null,i.a.createElement(W,null,i.a.createElement(F.c,{to:"/profile/"+t},i.a.createElement(H,null,r)),i.a.createElement(L,null,"\u0431\u044b\u0432 \u0432 \u0441\u0435\u0442\u0438 "+l)),i.a.createElement(W,null,i.a.createElement(F.c,{to:"/profile/"+t},i.a.createElement(Q,null,i.a.createElement("img",{src:a.small||U.a,alt:"user avatar",width:"30",height:"30"})))))};function Y(){var e=Object(l.a)(["\n  flex: 1 1 auto;\n  display: flex;\n  flex-direction: column;\n  width: 70%;\n  border-left: 1px solid ",";\n"]);return Y=function(){return e},e}var Z=u.b.div(Y(),d.a.border),$=function(e){return i.a.createElement(Z,null,e.dialogInfo?i.a.createElement(X,{dialogInfo:e.dialogInfo}):void 0,i.a.createElement(T,{messages:e.messages,friendId:e.friendId,isGettingMessagesInProgress:e.isGettingMessagesInProgress}),i.a.createElement(x,{onSubmit:e.sendMessage,isSendingMessageInProgress:e.isSendingMessageInProgress}))},_=t(22),ee=t(43),ne=t(42),te=t(313),re=t.n(te);function ae(){var e=Object(l.a)(["\n  width: 100px;\n  height: 100px;\n  background: url(",") center no-repeat;\n  background-size: cover;\n  opacity: 0.5;\n"]);return ae=function(){return e},e}function ie(){var e=Object(l.a)(["\n  flex: 1 1 auto;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  border-left: 1px solid ",";\n  font-size: 16px;\n  color: ",";\n"]);return ie=function(){return e},e}var se,oe=u.b.div(ie(),d.a.border,d.a.textThree),le=u.b.div(ae(),re.a),ue=Object(a.memo)((function(){return i.a.createElement(oe,null,i.a.createElement(le,null),"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0431\u0435\u0441\u0435\u0434\u0443")})),ce=t(30),de=t(79),ge=t.n(de),fe=ge.a.CancelToken.source(),be={sendMessage:ne.f,getMessages:ne.e,startChatting:ne.g,clearIntervalThunk:ce.b,setIntervalThunk:ce.e},pe=Object(_.d)(Object(s.b)((function(e){var n=ee.a.getMessages,t=ee.a.getAllDialogs,r=ee.a.getIsSendingMessageInProgress,a=ee.a.getIsStartChattingInProgress,i=ee.a.getIsGettingMessagesInProgress;return{messages:n(e),dialogs:t(e),isStartChattingInProgress:a(e),isSendingMessageInProgress:r(e),isGettingMessagesInProgress:i(e),startingIntervals:e.app.startingIntervals}}),be),o.f)((function(e){var n=Number(e.match.params.userId),t=function(){fe.cancel("Operation canceled by dialog change"),e.clearIntervalThunk(se,"messageUpdate")};Object(a.useEffect)((function(){if(n)return t(),fe=ge.a.CancelToken.source(),e.setIntervalThunk((function(){return e.getMessages(n,fe.token)}),1e3,"messageUpdate"),se=e.startingIntervals.get("messageUpdate"),function(){t()};t()}),[n]);if(!n)return i.a.createElement(ue,null);var r=function(n){var t=e.dialogs.filter((function(e){return e.id===n}));if(t)return t[0]}(n);return r||e.isStartChattingInProgress||e.startChatting(n),i.a.createElement($,{messages:e.messages,sendMessage:function(t){t.message&&0!==t.message.trim().length&&(e.sendMessage(n,t.message),!(!e.dialogs||e.dialogs&&!e.dialogs.length)&&(!n||n&&e.dialogs[0].id===n)||e.isStartChattingInProgress||e.startChatting(n))},dialogInfo:r,friendId:n,isSendingMessageInProgress:e.isSendingMessageInProgress,isGettingMessagesInProgress:e.isGettingMessagesInProgress,isStartChattingInProgress:e.isStartChattingInProgress})}));function me(){var e=Object(l.a)(["\n  position: absolute;\n  bottom: 6px;\n  right: 18px;\n  width: 28px;\n  height: 18px;\n  border-radius: 45%;\n  background-color: ",";\n  color: ",";\n  font-size: 10px;\n  line-height: 18px;\n  font-weight: 600;\n  text-align: center;\n  white-space: nowrap;\n  overflow: hidden;\n"]);return me=function(){return e},e}function ve(){var e=Object(l.a)(["\n  color: ",";\n"]);return ve=function(){return e},e}function he(){var e=Object(l.a)(["\n  color: ",";\n  font-weight: 600;\n"]);return he=function(){return e},e}function Ie(){var e=Object(l.a)(["\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n"]);return Ie=function(){return e},e}function xe(){var e=Object(l.a)(["\n  flex: 1 1 auto;\n  display: flex;\n  justify-content: space-between;\n  overflow: hidden;\n"]);return xe=function(){return e},e}function je(){var e=Object(l.a)(["\n  flex: 0 0 ","px;\n  margin-right: 10px;\n  width: ","px;\n  height: ","px;\n  border-radius: 50%;\n  overflow: hidden;\n"]);return je=function(){return e},e}function Oe(){var e=Object(l.a)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  padding: 10px 10px;\n  width: 100%;\n  text-decoration: none;\n  background-color: ",";\n\n  &:hover {\n    background-color: rgba(0, 0, 0, 0.03);\n  }\n"]);return Oe=function(){return e},e}function we(){var e=Object(l.a)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  padding: 10px 10px;\n  width: 100%;\n  text-decoration: none;\n  background-color: ",";\n"]);return we=function(){return e},e}u.b.div(we(),(function(e){return"true"===e.active?"rgba(0, 0, 0, 0.07)":void 0}));var Ee=Object(u.b)(F.c)(Oe(),(function(e){return"true"===e.active?"rgba(0, 0, 0, 0.07)":void 0})),Me=u.b.div(je(),(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.size})),ye=u.b.div(xe()),ze=u.b.span(Ie()),De=Object(u.b)(ze)(he(),d.a.textPrimary),Pe=Object(u.b)(ze)(ve(),d.a.textThree),ke=u.b.span(me(),d.a.secondary,d.a.light),Ge=function(e){return i.a.createElement(Me,{size:e.size},i.a.createElement("img",{src:e.photo,alt:"user avatar",width:e.size,height:e.size}))},Se=function(e){var n=e.friendId===e.userId,t=new Date(Date.parse(e.lastDialogActivityDate)),r=new Intl.DateTimeFormat("ru",{day:"numeric",month:"short"}).format(t),a=e.newMessagesCount>99?"99+":e.newMessagesCount,s=Ee;return i.a.createElement(s,{to:"/direct/"+e.userId,active:n.toString()},i.a.createElement(Ge,{photo:e.photo,size:e.size||50}),i.a.createElement(ye,null,i.a.createElement(De,null,e.userName),i.a.createElement(Pe,null,r)),0!==a?i.a.createElement(ke,null,a):void 0)};function Ae(){var e=Object(l.a)([""]);return Ae=function(){return e},e}function Ce(){var e=Object(l.a)(["\n  flex: none;\n  width: 30%;\n  overflow-y: auto;\n"]);return Ce=function(){return e},e}var Te,Ne=u.b.div(Ce()),Ue=u.b.div(Ae()),Fe=function(e){var n=Object(a.useRef)(null),t=e.dialogs.map((function(n,t){var r=n.id,a=n.userName,s=n.lastDialogActivityDate,o=n.lastUserActivityDate,l=n.hasNewMessages,u=n.newMessagesCount;return i.a.createElement(Se,{userId:r,userName:a,photo:n.photos.small||U.a,lastDialogActivityDate:s,lastUserActivityDate:o,hasNewMessages:l,newMessagesCount:u,friendId:e.friendId,key:t,isGettingMessagesInProgress:e.isGettingMessagesInProgress})}));return i.a.createElement(Ne,null,i.a.createElement("div",{ref:n}),i.a.createElement(Ue,null,t))},Je={getAllDialogs:ne.d,clearIntervalThunk:ce.b,setIntervalThunk:ce.e,clearMessages:ne.b},Re=Object(_.d)(Object(s.b)((function(e){var n=ee.a.getAllDialogs,t=ee.a.getIsGettingDialogsInProgress,r=ee.a.getIsGettingMessagesInProgress;return{dialogs:n(e),isGettingDialogsInProgress:t(e),isGettingMessagesInProgress:r(e),startingIntervals:e.app.startingIntervals}}),Je),o.f)((function(e){var n=Number(e.match.params.userId);return Object(a.useEffect)((function(){return e.clearMessages(),e.setIntervalThunk((function(){return e.getAllDialogs()}),1e3,"dialogsUpdate"),Te=e.startingIntervals.get("dialogsUpdate"),function(){e.clearIntervalThunk(Te,"dialogsUpdate")}}),[e.match.path]),i.a.createElement(Fe,{dialogs:e.dialogs,friendId:n,isGettingMessagesInProgress:e.isGettingMessagesInProgress})}));function Ke(){var e=Object(l.a)(["\n  flex: 1 0 auto;\n  display: flex;\n  padding: 138px 20px 20px;\n  max-height: 100vh;\n"]);return Ke=function(){return e},e}function Ve(){var e=Object(l.a)(["\n  padding: 0;\n  flex: 1 0 auto;\n  display: flex;\n  flex-direction: column;\n"]);return Ve=function(){return e},e}var qe=u.b.main(Ve()),Be=Object(u.b)(c.a)(Ke()),He=function(e){return e.initialized?i.a.createElement(qe,null,i.a.createElement(Be,null,i.a.createElement(Re,null),i.a.createElement(pe,null))):i.a.createElement(k.a,null)},Le=t(243),Qe={updateInitialized:ne.i,updateDialogsInitialized:ne.h,updateMessagesInitialized:ne.j,getAllDialogs:ne.d,getMessages:ne.e};n.default=Object(_.d)(Object(s.b)((function(e){var n,t=ee.a.getInitializedMessages,a=ee.a.getInitializedDialogs,i=ee.a.getInitialized,s=ee.a.getIsGettingMessagesInProgress,o=ee.a.getIsGettingDialogsInProgress,l=ee.a.getMessages,u=ee.a.getAllDialogs;return n={initializedMessages:t(e),initializedDialogs:a(e),initialized:i(e),isGettingMessagesInProgress:s(e),isGettingDialogsInProgress:o(e),messages:l(e),dialogs:u(e)},Object(r.a)(n,"initializedMessages",t(e)),Object(r.a)(n,"initializedDialogs",a(e)),n}),Qe),o.f,Le.a)((function(e){var n=e.match.params.userId;return Object(a.useEffect)((function(){e.isGettingMessagesInProgress||null===n||void 0===n||e.getMessages(n),e.isGettingDialogsInProgress||e.dialogs||e.getAllDialogs()}),[n]),e.initializedDialogs||null===e.dialogs||void 0===e.dialogs||e.updateDialogsInitialized(),e.initializedMessages||n&&(null===e.messages||void 0===e.messages)||e.updateMessagesInitialized(),!e.initialized&&e.initializedMessages&&e.initializedDialogs&&e.updateInitialized(),i.a.createElement(He,{initialized:e.initialized})}))}}]);
//# sourceMappingURL=7.88705cbe.chunk.js.map